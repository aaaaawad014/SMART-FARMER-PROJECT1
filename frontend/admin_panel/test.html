<!DOCTYPE html>
<html>
<head>
    <title>Connection Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 5px; }
        .success { color: green; }
        .error { color: red; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Connection Test</h1>
    <button onclick="testFirebase()">Test Firebase</button>
    <button onclick="testAdminLogic()">Test Admin Logic</button>
    <button onclick="testBackend()">Test Backend API</button>
    <button onclick="testAll()">Test Everything</button>
    
    <div id="log" class="log"></div>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="../js/firebase-config.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/admin-logic.js"></script>
    
    <script>
        const log = document.getElementById('log');
        
        function addLog(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            log.innerHTML += `<div class="${type}">[${time}] ${message}</div>`;
            console.log(message);
        }
        
        async function testFirebase() {
            addLog("Testing Firebase...");
            try {
                if (typeof firebase === 'undefined') {
                    throw new Error("Firebase not loaded");
                }
                
                const user = firebase.auth().currentUser;
                if (user) {
                    addLog(`‚úÖ Firebase OK - User: ${user.email}`, 'success');
                } else {
                    addLog("‚ö†Ô∏è Firebase OK but no user logged in", 'warning');
                }
            } catch (error) {
                addLog(`‚ùå Firebase Error: ${error.message}`, 'error');
            }
        }
        
        async function testAdminLogic() {
            addLog("Testing Admin Logic...");
            try {
                const functions = [
                    'loadAllComplaints',
                    'loadAllInventory', 
                    'loadAllFeedback',
                    'getDashboardStats',
                    'addInventoryItem',
                    'updateComplaint'
                ];
                
                let allGood = true;
                for (const func of functions) {
                    if (typeof window[func] !== 'function') {
                        addLog(`‚ùå Missing: ${func}`, 'error');
                        allGood = false;
                    }
                }
                
                if (allGood) {
                    addLog("‚úÖ All admin functions loaded", 'success');
                }
                
            } catch (error) {
                addLog(`‚ùå Admin Logic Error: ${error.message}`, 'error');
            }
        }
        
        async function testBackend() {
            addLog("Testing Backend Connection...");
            try {
                const response = await fetch('http://localhost:3000/');
                const data = await response.json();
                addLog(`‚úÖ Backend reachable: ${data.msg}`, 'success');
                
                // Test admin endpoints
                const user = firebase.auth().currentUser;
                if (user) {
                    const token = await user.getIdToken();
                    const testResponse = await fetch('http://localhost:3000/api/admin/complaints', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    
                    if (testResponse.status === 200) {
                        addLog("‚úÖ Admin API endpoint accessible", 'success');
                    } else {
                        addLog(`‚ö†Ô∏è Admin API status: ${testResponse.status}`, 'warning');
                    }
                }
                
            } catch (error) {
                addLog(`‚ùå Backend Error: ${error.message}`, 'error');
                addLog("üí° Make sure backend is running: npm start in backend folder", 'info');
            }
        }
        
        async function testAll() {
            log.innerHTML = '';
            await testFirebase();
            await testAdminLogic();
            await testBackend();
        }
        
        addLog("Connection test page loaded");
    </script>
</body>
</html>